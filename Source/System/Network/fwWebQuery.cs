#region Using framework
using System;
using System.Net;
#endregion





namespace Pluton.SystemProgram.Devices
{
    ///--------------------------------------------------------------------------------------
    ///--------------------------------------------------------------------------------------








     ///=====================================================================================
    ///
    /// <summary>
    /// Команды отправляемые на сервер
    /// </summary>
    /// 
    ///--------------------------------------------------------------------------------------
    public class AWebQuery
    {
        ///--------------------------------------------------------------------------------------
        private EStatus     mStatus = EStatus.none; //текущий статус команды
        private int         mCountSend = 0;             //количество попыток отправки
        ///--------------------------------------------------------------------------------------






         ///=====================================================================================
        ///
        /// <summary>
        /// описание текущего статуса команды
        /// </summary>
        /// 
        ///--------------------------------------------------------------------------------------
        public enum EStatus
        {
            none,
            idle,
            execute,
            executeCompleted
        }
        ///--------------------------------------------------------------------------------------





         ///=====================================================================================
        ///
        /// <summary>
        /// constructor
        /// </summary>
        /// 
        ///--------------------------------------------------------------------------------------
        public AWebQuery()
        {
        }
        ///--------------------------------------------------------------------------------------









         ///=====================================================================================
        ///
        /// <summary>
        /// проверяет статус, команда запущенна илил нет
        /// </summary>
        /// 
        ///--------------------------------------------------------------------------------------
        public bool isExecute()
        {
            return mStatus == EStatus.idle || mStatus == EStatus.execute;
        }
        ///--------------------------------------------------------------------------------------






        ///=====================================================================================
        ///
        /// <summary>
        /// проверяет статус, команда выполнела свой запрос или нет
        /// </summary>
        /// 
        ///--------------------------------------------------------------------------------------
        public bool isCompleted()
        {
            return mStatus == EStatus.executeCompleted;
        }
        ///--------------------------------------------------------------------------------------







         ///=====================================================================================
        ///
        /// <summary>
        /// команду отправили в стек выполенения 
        /// </summary>
        /// 
        ///--------------------------------------------------------------------------------------
        public int sendQueue()
        {
            mStatus = EStatus.idle;
            mCountSend++;
            return mCountSend;
        }
        ///--------------------------------------------------------------------------------------





         ///=====================================================================================
        ///
        /// <summary>
        /// начало выполнения команды
        /// </summary>
        /// 
        ///--------------------------------------------------------------------------------------
        public void send(WebClient web, int deviceID)
        {
            mStatus = EStatus.execute;
            onSend(web, deviceID);
        }
        ///--------------------------------------------------------------------------------------




         ///=====================================================================================
        ///
        /// <summary>
        /// начало выполнения команды
        /// </summary>
        /// 
        ///--------------------------------------------------------------------------------------
        protected virtual void onSend(WebClient web, int deviceID)
        {
        }
        ///--------------------------------------------------------------------------------------






        ///=====================================================================================
        ///
        /// <summary>
        /// команда выполнилась
        /// </summary>
        /// 
        ///--------------------------------------------------------------------------------------
        public void execute(string data)
        {
            mStatus = EStatus.executeCompleted;
            onExecute(data);
            mCountSend = 0;
            if (signal_completed != null)
            {
                signal_completed(this);
            }
        }
        ///--------------------------------------------------------------------------------------


 
         ///=====================================================================================
        ///
        /// <summary>
        /// команда выполнилась
        /// </summary>
        /// 
        ///--------------------------------------------------------------------------------------
        protected virtual void onExecute(string data)
        {
        }
        ///--------------------------------------------------------------------------------------






        ///--------------------------------------------------------------------------------------
        public delegate void eventQuery(AWebQuery query);
        public event eventQuery signal_completed;
        ///--------------------------------------------------------------------------------------







        ///=====================================================================================
        ///
        /// <summary>
        /// конец выполнения сообщения
        /// </summary>
        /// 
        ///--------------------------------------------------------------------------------------
        public EStatus status
        {
            get
            {
                return mStatus;
            }
        }
        ///--------------------------------------------------------------------------------------






         ///=====================================================================================
        ///
        /// <summary>
        /// очистить всю команду
        /// </summary>
        /// 
        ///--------------------------------------------------------------------------------------
        public void clear()
        {
            mStatus = EStatus.none;
            mCountSend = 0;
            onClear();
        }
        ///--------------------------------------------------------------------------------------





         ///=====================================================================================
        ///
        /// <summary>
        /// очистить всю команду
        /// </summary>
        /// 
        ///--------------------------------------------------------------------------------------
        protected virtual void onClear()
        {
        }
        ///--------------------------------------------------------------------------------------






        ///=====================================================================================
        ///
        /// <summary>
        /// событие простое, без параметров
        /// </summary>
        /// 
        ///--------------------------------------------------------------------------------------
        /*
        public void eventLog(string eventName)
        {
            
        }*/
        ///--------------------------------------------------------------------------------------





    }
}
